self.onload=function(){if("object"==typeof nwpp){var a=document.getElementsByTagName("a"),b=getPathnames(a);fetchPredictions(b,a)}};function fetchPredictions(a,b){jQuery.post(nwpp.ajaxUrl,{"pathnames[]":a,current_pathname:getCurrentPathname(),action:"nwpp_get_predictions"}).done(function(a){for(var c=new NWPPCache,d=[],e=0;e<a.length;e++)d.push(a[e].replace(/\/$/,""));c.save(b,d)}).fail(function(a,b){console.log(b)})}function getPathnames(a){for(var b,c=getCurrentPathname(),d=[],e=0;e<a.length;e++)b=a[e],b.host.includes(nwpp.homeUrl)&&b.pathname!==c&&-1===d.indexOf(b.pathname)&&d.push(b.pathname);return d}function getCurrentPathname(){var a=window.location.pathname;return a.substring(0,a.lastIndexOf("/")+1)}class NWPPCache{constructor(){this.homeUrl=nwpp.homeUrl.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}save(a,b){self.hasOwnProperty("caches")&&self.hasOwnProperty("fetch")?caches.open("nwpp-"+nwpp.homeUrl).then(function(c){this.saveViaCacheAPI(c,a,b)}.bind(this)):this.setToCacheViaRelPrefetch(a,b)}async saveViaCacheAPI(a,b,c){for(var d,e=[],f=0;f<b.length&&!((d=c.indexOf(b[f].pathname.replace(/\/$/,"")),-1!==d)&&(e.push(b[f].href),c.splice(d,1),!c.length));f++);this.cache=a;var g,h;try{h=parseInt(nwpp.maxCacheSize),g=await navigator.storage.estimate().then(function(a){return a.usage}.bind(this))}catch(a){h=g=0,console.error(a)}finally{g>=h&&(await this.cache.keys().then(function(a){a.forEach(function(a){this.cache.delete(a)}.bind(this))}.bind(this)))}e.map(function(a){fetch(a).then(this.setDocument.bind(this))}.bind(this))}setDocument(a){if(!(200>a.status||299<a.status)){if(nwpp.doCacheImages){var b=a.clone();b.text().then(this.setImgs.bind(this))}return this.cache.put(a.url,a)}}setImgs(a){for(var b,c=[],d=/src=["|'](\/[^"|']*(png|jpg|jpeg|gif|ico){1})/igm;null!=(b=d.exec(a));)"object"==typeof b&&b&&b[1]&&c.push(window.location.origin+b[1]);var e="(https?:\\/\\/(www\\.)?("+this.homeUrl+")+[^\\s\"]+)\\.(png|jpg|jpeg|gif){1}",f=new RegExp(e,"gim"),g=a.match(f);if(c=c.concat(g),c&&c.length){for(var h=[],j=0;j<c.length;j++)c[j]&&!h.includes(c[j])&&h.push(c[j]);try{this.cache.addAll(h)}catch(a){console.error(a)}}}setToCacheViaRelPrefetch(a,b){for(var c,d=document.getElementsByTagName("head")[0],e=0;e<a.length;e++)if(c=b.indexOf(a[e].pathname),-1!==c){var f=document.createElement("link");if(f.setAttribute("rel","prefetch"),f.setAttribute("href",a[e].href),d.appendChild(f),b.splice(c,1),!b.length)break}}}
